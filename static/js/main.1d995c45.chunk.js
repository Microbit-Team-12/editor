(this.webpackJsonpeditor=this.webpackJsonpeditor||[]).push([[0],{49:function(e,t){},51:function(e,t){},61:function(e,t,n){},63:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var r=n(9),a=n.n(r),i=n(29),o=n.n(i),s=n(0),c=n.n(s),u=n(1),l=n(4),p=n(5),f=n(3),h=n(33),d=n(31),b=n(32),v=n(30),x={connectOption:{baudRate:115200,dataBits:8,stopBits:1,parity:"none",bufferSize:4096,flowControl:"none"},requestOption:{filters:[{usbVendorId:3368}]},readOption:{showLog:!0,updateMs:50,cutLength:1e3},signalOption:{showLog:!0,replLineReady:">>> ",executionDone:"Execute Done: 0x3f3f3f3f",executionStart:"Execution Start: 0x3f3f3f3f",mainPYException:'Traceback (most recent call last):\r\n  File "main.py", line ',execException:'Traceback (most recent call last):\r\n  File "<stdin>", line 1, in <module>\r\n  File "<string>", line ',waitMsBeforeReboot:1}},k=n(14),w=n.n(k),O=function(){function e(t,n){Object(l.a)(this,e),this.portReader=void 0,this.signal=void 0,this.portReader=t,this.signal=n}return Object(p.a)(e,[{key:"readUntilNewREPLLine",value:function(){return this.portReader.safeReadUntil(this.signal.replLineReady)}},{key:"readUntilExecutionStart",value:function(){return this.portReader.safeReadUntil(this.signal.executionStart+"\r\n")}},{key:"readUntilExecuteDone",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r,a,i,o,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[this.signal.executionDone+"\r\n",this.signal.mainPYException,this.signal.execException],e.next=3,this.portReader.safeReadUntilWithUpdate(n,(function(e){return t.write({kind:"NormalOutput",outputChunk:e})}));case 3:if(r=e.sent,console.log("Execution done"),r===this.signal.executionDone+"\r\n"){e.next=19;break}return e.next=8,this.portReader.unsafeReadline();case 8:a=e.sent,i=a.split(",",2)[0],o="  ";case 11:if(!o.startsWith("  ")){e.next=17;break}return e.next=14,this.portReader.unsafeReadline();case 14:o=e.sent,e.next=11;break;case 17:s=o.split(": "),t.write({kind:"ErrorMessage",line:parseInt(i)-1,type:s[0],message:s[1]});case 19:t.end();case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),m=function(){function e(t,n){Object(l.a)(this,e),this.serialBuffer="",this.portReader=void 0,this.config=void 0,this.portReader=t,this.config=n}return Object(p.a)(e,[{key:"readLoop",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t(this.serialBuffer)){e.next=8;break}return e.next=3,this.portReader.read();case 3:n=e.sent,r=n.value,this.serialBuffer+=r,e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readLoopWithCut",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t(this.serialBuffer)){e.next=10;break}return(r=this.serialBuffer.length)>=n&&(this.serialBuffer=this.serialBuffer.substring(r-n)),e.next=5,this.portReader.read();case 5:a=e.sent,i=a.value,this.serialBuffer+=i,e.next=0;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"splitBufferOnFirst",value:function(e){var t=this.serialBuffer.indexOf(e),n=this.serialBuffer.substr(0,t);return this.serialBuffer=this.serialBuffer.substr(t+e.length),n}},{key:"unsafeReadline",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="\r\n",e.next=3,this.readLoop((function(e){return e.includes(t)}));case 3:return e.abrupt("return",this.splitBufferOnFirst(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"safeReadUntil",value:function(){var e=Object(u.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readLoopWithCut((function(e){return e.includes(t)}),t.length);case 2:this.splitBufferOnFirst(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"safeReadUntilWithUpdate",value:function(){var e=Object(u.a)(c.a.mark((function e(t,n){var r,a,i,o,s=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!1,a="",i=function(e){return r=!0,t.forEach((function(t){e.includes(t)&&(a=t)})),""!==a},o=setInterval((function(){r&&(n(s.serialBuffer),r=!1)}),this.config.updateMs),e.next=6,this.readLoopWithCut(i,this.config.cutLength);case 6:return clearInterval(o),n(this.splitBufferOnFirst(a)),e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),g=function(){function e(t,n){if(Object(l.a)(this,e),this.port=void 0,this.portWriter=void 0,this.portReader=void 0,this.portParser=void 0,this.signal=void 0,this.port=t,this.signal=n.signalOption,null!=t.writable){var r=new TextEncoderStream;r.readable.pipeTo(t.writable).catch((function(e){console.log("disconnected in pipe")})),this.portWriter=r.writable.getWriter()}if(null!=t.readable){var a=new TextDecoderStream;t.readable.pipeTo(a.writable).catch((function(e){console.log("disconnected in pipe")})),this.portReader=a.readable.getReader();var i=new m(this.portReader,n.readOption);this.portParser=new O(i,n.signalOption)}}return Object(p.a)(e,[{key:"codeToPythonString",value:function(e){return("print('"+this.signal.executionStart+"')\r\n"+e+"\r\nprint('"+this.signal.executionDone+"')").replaceAll("\\","\\\\").replaceAll("'","\\'").replaceAll(/\r?\n/g,"\\r\\n")}},{key:"getREPLLine",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.portWriter.write("\x03");case 2:return e.next=4,this.portParser.readUntilNewREPLLine();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"flash",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.codeToPythonString(t),r=new w.a,e.next=4,this.getREPLLine();case 4:return e.next=6,this.portWriter.write("file=open('main.py','w');s='"+n+"';file.write(s);file.close();from microbit import *;reset()\r");case 6:return e.next=8,this.portParser.readUntilExecutionStart();case 8:return this.portParser.readUntilExecuteDone(r).catch((function(){r.end()})),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"execute",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.codeToPythonString(t),r=new w.a,e.next=4,this.getREPLLine();case 4:return e.next=6,this.portWriter.write("s='"+n+"';exec(s)\r");case 6:return e.next=8,this.portParser.readUntilExecutionStart();case 8:return this.portParser.readUntilExecuteDone(r).catch((function(){r.end()})),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reboot",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getREPLLine();case 2:return e.next=4,this.portWriter.write("from microbit import *;reset()\r");case 4:return e.next=6,this.portParser.readUntilExecutionStart();case 6:return t=new w.a,this.portParser.readUntilExecuteDone(t).catch((function(){t.end()})),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"interrupt",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.portWriter.write("\x03");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function y(e,t){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(c.a.mark((function e(t,n){var r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.open(n.connectOption);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",{kind:"ConnectionFailure",type:"Failed to Open Port",reason:e.t0.message});case 8:return r=new g(t,n),e.abrupt("return",{kind:"MicrobitConnection",interact:r,disconnection:new Promise((function(e,n){t.addEventListener("disconnect",(function n(r){console.log("disconnected"),t.removeEventListener("disconnect",n),e()}))}))});case 10:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function P(){return R.apply(this,arguments)}function R(){return(R=Object(u.a)(c.a.mark((function e(){var t,n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:x,e.prev=1,e.next=4,navigator.serial.requestPort(t.requestOption);case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{kind:"ConnectionFailure",type:"Failed to Obtain Port",reason:e.t0.message});case 10:return e.abrupt("return",y(n,t));case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function E(){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(c.a.mark((function e(){var t,n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:x,e.next=3,navigator.serial.getPorts();case 3:if(1!==(n=e.sent).length){e.next=8;break}return e.abrupt("return",y(n[0],t));case 8:return e.abrupt("return",{kind:"ConnectionFailure",type:"Failed to Obtain Port",reason:"Multiple or No Serial Devices Available"});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return I.apply(this,arguments)}function I(){return(I=Object(u.a)(c.a.mark((function e(){var t,n,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(e,t){if(void 0===t)return!0;var n,r=Object(b.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if((void 0===a.usbProductId||a.usbProductId===e.usbProductId)&&(void 0===a.usbVendorId||a.usbVendorId===e.usbVendorId))return!0}}catch(i){r.e(i)}finally{r.f()}return!1},t=r.length>0&&void 0!==r[0]?r[0]:x,e.abrupt("return",new Promise((function(e,r){var a=function(){var r=Object(u.a)(c.a.mark((function r(i){var o;return c.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:o=i.port||i.target,n(o.getInfo(),t.requestOption.filters)&&(navigator.serial.removeEventListener("connect",a),e(y(o,t)));case 2:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();navigator.serial.addEventListener("connect",a)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(61);var L,B=n(2),D=function(e){Object(h.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).state={code:"from microbit import *\nwhile True:\n    print(1)\n    sleep(100)",output:""},r.onStart=r.onStart.bind(Object(f.a)(r)),r.onFlash=r.onFlash.bind(Object(f.a)(r)),r.onCodeChange=r.onCodeChange.bind(Object(f.a)(r)),r.onReboot=r.onReboot.bind(Object(f.a)(r)),r.onExec=r.onExec.bind(Object(f.a)(r)),r.onInterrupt=r.onInterrupt.bind(Object(f.a)(r)),r.onRun=r.onRun.bind(Object(f.a)(r)),r.connect=r.connect.bind(Object(f.a)(r)),L=null,"serial"in navigator||"usb"in navigator&&(navigator.serial=v.serial,1)||alert("Browser not supported"),r}return Object(p.a)(n,[{key:"render",value:function(){return Object(B.jsxs)("div",{className:"APIDemo",children:[Object(B.jsxs)("header",{className:"APIDemo-header",children:[Object(B.jsx)("button",{className:"APIDemo-button",onClick:this.onStart,children:"Start"}),Object(B.jsx)("button",{className:"APIDemo-button",onClick:this.onRun,children:"Run Code"}),Object(B.jsx)("button",{className:"APIDemo-button",onClick:this.onFlash,children:"Flash Code"}),Object(B.jsx)("button",{className:"APIDemo-button",onClick:this.onInterrupt,children:"Interrupt"}),Object(B.jsx)("button",{className:"APIDemo-button",onClick:this.onReboot,children:"Reboot"})]}),Object(B.jsxs)("div",{className:"APIDemo-textareas",children:[Object(B.jsx)("textarea",{value:this.state.code,onChange:this.onCodeChange,className:"APIDemo-code"}),Object(B.jsx)("textarea",{value:this.state.output,readOnly:!0,className:"APIDemo-output"})]})]})}},{key:"connect",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n,r=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:n=e.sent,e.t0=n.kind,e.next="ConnectionFailure"===e.t0?6:"MicrobitConnection"===e.t0?8:11;break;case 6:return alert(n.reason),e.abrupt("return",!1);case 8:return L=n,n.disconnection.then(Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("Serial disconnected"),L=null,e.next=4,r.connect(S());case 4:alert("Serial reconnected");case 5:case"end":return e.stop()}}),e)})))),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onCodeChange",value:function(e){this.setState({code:e.target.value})}},{key:"onStart",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.connect(E());case 2:if(e.sent){e.next=4;break}this.connect(P());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onExec",value:function(){var e=Object(u.a)(c.a.mark((function e(t){var n=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.forEach((function(e){"NormalOutput"===e.kind?n.setState({output:e.outputChunk}):"KeyboardInterrupt"!==e.type&&alert("Error on line "+e.line+":\n"+e.type+": "+e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onFlash",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFlash"),t=this.state.code,null===L){e.next=10;break}return e.t0=this,e.next=6,L.interact.flash(t);case 6:e.t1=e.sent,e.t0.onExec.call(e.t0,e.t1),e.next=11;break;case 10:alert("No device is connected. Press 'Start' to connect a device.");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onRun",value:function(){var e=Object(u.a)(c.a.mark((function e(){var t;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onFlash"),t=this.state.code,null===L){e.next=10;break}return e.t0=this,e.next=6,L.interact.execute(t);case 6:e.t1=e.sent,e.t0.onExec.call(e.t0,e.t1),e.next=11;break;case 10:alert("No device is connected. Press 'Start' to connect a device.");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onReboot",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onReboot"),null===L){e.next=9;break}return e.t0=this,e.next=5,L.interact.reboot();case 5:e.t1=e.sent,e.t0.onExec.call(e.t0,e.t1),e.next=10;break;case 9:alert("No device is connected. Press 'Start' to connect a device.");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onInterrupt",value:function(){var e=Object(u.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!==L?L.interact.interrupt():alert("No device is connected. Press 'Start' to connect a device.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(a.a.Component);n(63);o.a.render(Object(B.jsx)(a.a.StrictMode,{children:Object(B.jsx)(D,{})}),document.getElementById("root"))}},[[64,1,2]]]);
//# sourceMappingURL=main.1d995c45.chunk.js.map